# 🏗 Stage 1: Build dependencies and code
FROM node:18 AS builder

WORKDIR /app

# Copy only package files first for better caching
COPY package*.json ./

# Install dependencies
RUN npm install

# Now copy the rest of the source code
COPY . .

# 🧼 Stage 2: Final, minimal image
FROM node:18-slim

WORKDIR /app

# Copy only the built app from builder stage
COPY --from=builder /app .

# Install only production dependencies
RUN npm install --omit=dev

# Start the app
CMD ["npm", "start"]
